# 面向 Vision‑Language‑Action（VLA）、自动驾驶/具身与语音交互的多模态大模型预训练教程（公开版）

**读者画像**：AI Scientist｜中型研发团队的 Infra/系统工程师
**目标产物**：1B 与 10B 参数档的生产级 **Pretrain Checkpoint** 及全链路可复现工程
**覆盖模态**：Text / Audio / Video / Image / 3D
**底层框架**：Megatron 系列（TransformerEngine / FP8 / BF16），单次训练以 **10T token** 过一遍为准，集群 **256×H100 80GB** 参考设计
**合规声明**：数据采集与使用需遵守各来源许可及平台政策（例如优先使用官方 API、尊重 robots.txt，不提供绕过访问控制的手段）

---

## 已确认的设计约束（据用户指示）

* **语种**：包含方言/少数语种，**以 IPA（国际音标）兜底统一表征**。
* **视频标准**：**6‑camera 环视 480p@12 Hz**（多摄同步），按此制定采样与存储/搬运预算。
* **MoE**：采用**先进路由/并行架**（10B 档主打 MoE；1B 为 Dense 基线）。
* **精度**：**主干 FP8 + BF16 优化器**（TransformerEngine）。
* **3D 优先级**：1) **Blender/CAD 脚本的程序化几何**；2) **X3D‑类文本结构化格式**；3) **.obj** 作为回落；必要时再扩展点云/网格常用格式。
* **驾驶视频**：明确**多摄/环视**与传感器时间同步需求。

---

## 目录（index）

### [chapter1.md] 前言、范围与读者指南

* 1.1 为什么是 VLA：统一感知‑语言‑行动的产业动因
* 1.2 三大落地场景：自动驾驶/具身、语音交互助手、通用多模体检索/生成
* 1.3 本书产物与不在 scope 的内容
* 1.4 环境前置与硬件/软件依赖清单（Megatron/TE，**FP8 主干 + BF16 优化器**）
* 1.5 内容导航与阅读路径（Scientist vs. Infra）
* 1.6 与时间线的衔接方式（每章的 **[里程碑]** 标注规则）

### [chapter2.md] 全局时间线与里程碑（W0–W26）

* 2.1 总览甘特：数据→模型→训练→馏→评测→交付
* 2.2 关键里程碑：

  * **W0–W2** 方案冻结 & PoC；**W3–W6** 采集/治理 MVP；
  * **W7–W10** 1B 端到端跑通；**W11–W18** 10B 主线预训练（10T/epoch）；
  * **W19–W22** 蒸馏与中期评测；**W23–W26** 收尾、复现包与发布
* 2.3 风险缓释检查点（数据、算力、带宽、法务）
* 2.4 交付物与验收口径（按周）

### [chapter3.md] 需求拆解与系统能力画像（VLA / AD / 语音）

* 3.1 VLA 抽象接口：观测→指令→行动 token 空间
* 3.2 自动驾驶与具身任务族：开环/闭环指标与回放‑到‑行动映射（**多摄环视输入**）
* 3.3 语音交互：ASR/TTS/对话联动与延迟预算（**IPA 兼容**）
* 3.4 上下文与记忆：长上下文与跨模态缓存
* 3.5 安全与伦理底线需求

### [chapter4.md] 数据总体策略与 **30T token** 配额（多语多模）

* 4.1 语种与模态配比：**中/英 90% + 他语 10%**（含**方言/少数语种 + IPA** 兜底）
* 4.2 料类型与“强中期训练（mid‑training）”角色
* 4.3 **配额表设计**：将 30T 分解到具体数据集（文本/音频/视频/图像/3D/合成） **[W3]**
* 4.4 温度采样与混合比调度（by stage）
* 4.5 数据谱系与治理台账（Data Lineage）

### [chapter5.md] 数据采集 I：网页文本与代码（合规）

* 5.1 目标域与白名单源
* 5.2 官方 API / 开源语料与“别人已洗好的包”的接入策略
* 5.3 抓取框架与高并发限流
* 5.4 元数据/版权/许可记录
* 5.5 增量抓取与重复去重（URL/SimHash/MinHash）
* 5.6 粗筛：语言/主题/毒性/PII

### [chapter6.md] 数据采集 II：**音频/语音**（播客、公开课、语音数据集）

* 6.1 来源与许可；VAD/VAD++ 管道
* 6.2 ASR 转写与多语 LID（**方言/少数语种 + IPA 对齐**）
* 6.3 说话人分离/聚类（Diarization）
* 6.4 噪声与版权音乐检测
* 6.5 切分与时间对齐、文本‑音频配对（含 IPA 层）
* 6.6 采样率/比特率与存预算 **[W4]**

### [chapter7.md] 数据采集 III：**视频**（长/短视频、驾驶/具身）

* 7.1 合规采集：**优先官方 API**、尊重 robots.txt/ToS
* 7.2 **多摄环视**：**6‑camera 480p@12 Hz** 时序同步、标定与外参/内参治理
* 7.3 帧采样与镜头检测；字幕/ASR 对齐
* 7.4 驾驶/具身专用：传感器同步（RGB、深度、IMU、CAN、地图）
* 7.5 大规模存储与**搬运成本**：冷/热层、对象存储与数据搬迁 **[W5]**
* 7.6 去重与相似片段合并；码率/编解码与归档策略

### [chapter8.md] 数据采集 IV：**图像**

* 8.1 通用图像与驾驶场景图像来源
* 8.2 EXIF/地理等元数据治理
* 8.3 多标签弱监督与质量分
* 8.4 NSFW/徽标/水印检测

### [chapter9.md] 数据采集 V：**3D（程序化优先）**

* 9.1 **Blender/CAD 脚本**：程序化几何与参数化场景（可回放、可版本化）
* 9.2 **X3D‑类文本结构化格式**：层级/拓扑/材质的文本化表示
* 9.3 **.obj 回落** 与互操作；必要时扩展到 .ply/.pcd
* 9.4 3D‑文本/视频对齐策略与标定元数据
* 9.5 3D 数据压缩、规整与重复检测

### [chapter10.md] 数据治理与质量度量（跨模态）

* 10.1 语义、格式、对齐一致性度量（含 IPA 层一致性）
* 10.2 Near‑duplicate/跨模态重复清理
* 10.3 PII/合规清洗与审计抽样
* 10.4 数据错配与漂移监控仪表盘 **[W6]**

### [chapter11.md] 过滤与去脏：**fastText 与小模型** 策略库

* 11.1 fastText 语言/主题/质量分布（加入**方言/少数语种**标签映射）
* 11.2 文本小模型：毒性/仇恨/广告/低质检测
* 11.3 音频小模型：VAD、LID、音乐/噪声、**IPA 一致性校验**
* 11.4 图像/视频小模型：NSFW/LOGO/水印/模糊/重复
* 11.5 3D 小模型：几何异常/拓扑缺陷
* 11.6 级联过滤与阈值回放（ROC/成本）

### [chapter12.md] 合成数据 I：**教科书式文本/指令**（Phi‑3 风格）

* 12.1 课程‑章‑节蓝图与知识网格 **[W6]**
* 12.2 规则化生成模板与验证器
* 12.3 难度爬坡与思维链/工具使用信号
* 12.4 防泄露与数据去重（对真实集）

### [chapter13.md] 合成数据 II：**音频/语音**

* 13.1 TTS 合成策略：多说话人/情感/语速/口音（含**方言 + IPA**）
* 13.2 文本→音频→ASR 回译闭环一致性
* 13.3 说话人与内容水印/指纹
* 13.4 语音指令与对话模板库

### [chapter14.md] 合成数据 III：**视频与 VLA 自博弈**（Agentic RL Self‑Play）

* 14.1 环境/模拟器接口与任务库（支持多摄渲染与遮挡）
* 14.2 轨迹‑文本‑动作三元组生成
* 14.3 失败案例挖掘与 Curriculum
* 14.4 质量评估与回放筛查 **[W7]**

### [chapter15.md] **Tokenizer 设计**：文本/音频/视频/图像/3D

* 15.1 文本：**Qwen tokenizer** + 多模扩词表
* 15.2 音频：神经编解码离散化（codec）+ **IPA 辅助 token 层**
* 15.3 图像/视频：Patch/Tubelet/视觉码本（VQ‑*），**6‑camera 时序/相机位姿标记**
* 15.4 3D：**程序化几何/脚本语言的 token 化** → X3D 文本 → .obj 标记
* 15.5 **连续特征兼容**：跨模态投影器与混合输入通道
* 15.6 词表增长与对齐标记设计

### [chapter16.md] 生成‑理解一体架构沿革（自 **Show‑O / Transfusion** 起）

* 16.1 **里程碑纵览**：Show‑O、Transfusion 到近年的统一生成‑理解趋势（多模与视频优先）
* 16.2 **目标函数谱系**：自回归（AR）/扩散（Diffusion）/流匹配（Flow‑Matching）/掩码生成（MGM）与混合训练
* 16.3 **干路与分支**：共享主干 vs. 双干路（视觉/语言）+ 交叉注意力；早期融合 vs. 晚期融合
* 16.4 **离散化与连续特征**：VQ/Codec‑LM、潜空间扩散与**连续特征兼容**（与本书第15章呼应）
* 16.5 **推理统一**：生成与判别的共形解码；指导/约束（CFG、控制信号）与动作头协同
* 16.6 **多摄/视频特化**：非对称编码、相机位姿/时间戳嵌入与记忆缓存
* 16.7 **训练策略**：任务交替、多任务采样、蒸馏桥接（判别→生成/生成→理解）
* 16.8 **工程折中**：吞吐、显存、通信与 MoE‑路由成本
* 16.9 **对本书方案的启示**：为何选 **Qwen‑式 AR 主干 + 先进 MoE + 早期融合**；何处预留与扩散/流匹配的接口
* 16.10 **未解问题与研究清单**：可扩展对齐、长时程一致性、跨模态因果性

### [chapter17.md] 模型架构：**Qwen‑式自回归 Transformer**（Dense / **先进 MoE**，早期融合）

* 17.1 1B/10B 结构参数：深度/宽度/头数/FFN 比例 **[W7]**
* 17.2 多模投影器与早期融合拓扑（相机位姿/时间戳嵌入）
* 17.3 **先进 MoE**：专家分组、Top‑k 路由、负载均衡与专家并行（10B 为主）
* 17.4 上下文长度与位置编码（旋转/相对）
* 17.5 动作空间与控制头（VLA head）
* 17.6 正则化与稳定性（RMSNorm、Dropout、激活）

### [chapter18.md] 训练基建：**Megatron on 256×H100**

* 18.1 并行切分：TP/PP/DP/专家并行与拓扑映射
* 18.2 通信栈与 NVLink/NVSwitch/IB 配置
* 18.3 **IO 与数据加载**：WebDataset/索引化 tar/缓存层
* 18.4 **存储与搬运**：对象存储、分层缓存、吞吐预算（**多摄 480p@12 Hz 视频优先级**） **[W8]**
* 18.5 Mixed Precision：**FP8 主干 + BF16 优化器**（TransformerEngine 配置）
* 18.6 容错、检查点与重启策略

### [chapter19.md] 训练配方：从 **1B 到 10B** 的生产级方案

* 19.1 学习率/批尺寸/采样调度（cosine/one‑cycle）
* 19.2 长序列/多模序列打包与高效填充（多摄时间对齐）
* 19.3 数据混合温度与阶段化（Cold→Mid→Hot）
* 19.4 正负样本与 InfoNCE/CE 混合损失（多模）
* 19.5 吞吐建模与算力‑时长预算 **[W9]**
* 19.6 **1B Dense** 端到端基线复现实验 **[W10]**
* 19.7 **10B 先进 MoE** 主训练与监控面板 **[W12–W18]**

### [chapter20.md] 蒸馏与教师：**Gemma‑式 logits 蒸馏** 等

* 20.1 蒸馏任务与温度/遮罩
* 20.2 知识转移到多模头（视觉/音频/3D/行动）
* 20.3 稳定性与蒸馏‑正则的权衡
* 20.4 蒸馏数据的采样与合规 **[W19]**

### [chapter21.md] 对齐与中期训练（Instruction/Mid‑training/偏好）

* 21.1 指令数据构造与多模对话格式（含 IPA 与多摄标签）
* 21.2 语音交互对齐：延迟/打断/唤醒词
* 21.3 行动对齐：轨迹监督、开环离线指标
* 21.4 轻量偏好优化与安全约束

### [chapter22.md] 评测与基准（多模/多语/VLA/驾驶/语音）

* 22.1 文本：理解/知识/代码/长上下文
* 22.2 语音：ASR WER/TTS MOS/对话延迟（**方言/少数语种 + IPA 层评测**）
* 22.3 视觉/视频：VQA/检索/时序定位（**多摄融合**）
* 22.4 VLA：开环成功率、决策延迟、回放一致性
* 22.5 自动驾驶：ADE/FDE、碰撞率、红灯违规等开环指标（多摄输入）
* 22.6 3D：程序化几何一致性、X3D 解析鲁棒性、传统网格任务
* 22.7 评测集防泄漏与计显著性 **[W20–W22]**

### [chapter23.md] 成本、运维与 MLOps

* 23.1 计算与能耗预算；碳足迹可观测
* 23.2 **视频存储/传输成本** 明细与优化（按 **6‑camera 480p@12 Hz** 估算）
* 23.3 训练监控：吞吐/显存/通信/掉速诊断
* 23.4 日志与事件：数据‑到‑模型的可追溯
* 23.5 回滚/再训练/增量数据接入 **[W18–W26]**

### [chapter24.md] 交付与复现

* 24.1 Checkpoint 结构与分片
* 24.2 Tokenizer/词表发布与兼容层（含 IPA/程序化 3D 词表）
* 24.3 推理样例与端到端 Demo（离线）
* 24.4 复现脚本与配置矩阵 **[W25]**
* 24.5 版本与模型卡（模型来源、局限、合规声明） **[W26]**

### [chapter25.md] 安全、法律与合规

* 25.1 许可矩阵与使用场景限制
* 25.2 PII/敏感内容治理与审计
* 25.3 平台政策（如 YouTube Data API/robots）与缓存策略
* 25.4 透明度与负责任 AI 报告

### [chapter26.md] 项目管理与人员阵型

* 26.1 组织架构与角色分工：Data/Model/Infra/Eval/法务/PM/SRE
* 26.2 团队规模与轮班：训练期间 7×24 值守
* 26.3 周节奏与例会、风险墙与红线管理
* 26.4 采购/预算/合同与里程碑对齐
* 26.5 外部协作与开源治理

### [chapter27.md] 常见陷阱与故障排查

* 27.1 训练不收敛/损失震荡
* 27.2 通信瓶颈/显存碎片/数据打包
* 27.3 评测“虚高”与数据泄漏
* 27.4 跨模态时间对齐误差（**多摄同步/漂移**）
* 27.5 过滤过严/过松的代价

### [appendixA.md] 配置与脚本模板（可复制）

* A.1 数据管道：抓取/索引/过滤/去重脚本骨架
* A.2 Tokenizer 训练与扩表配置（含 IPA 与程序化 3D 词表）
* A.3 Megatron 启动参数矩阵（TP/PP/DP/MoE；**FP8 主干+BF16 优化器**）
* A.4 监控仪表与告警规则
* A.5 评测清单与打分汇总表模板

### [appendixB.md] 术语表与符号约定

* B.1 缩略词
* B.2 记号与单位
* B.3 指标与统计学约定

---

